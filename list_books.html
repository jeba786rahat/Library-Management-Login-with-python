<!doctype html>
<html>
<head>
<title>Books</title>

<!-- Bootstrap CSS (required for Modals) -->
<link rel="stylesheet"
href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body class="p-3">

<h2>Books</h2>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% for cat,msg in messages %}
    <div class="alert alert-{{cat}}">{{ msg }}</div>
  {% endfor %}
{% endwith %}

<table class="table table-bordered table-hover">
  <thead class="table-dark">
    <tr>
      <th>ID</th><th>Title</th><th>Author</th><th>Serial</th><th>Available</th><th>Action</th>
    </tr>
  </thead>
  
  {% for b in books %}
  <tr>
    <td>{{ b.id }}</td>
    <td>{{ b.title }}</td>
    <td>{{ b.author }}</td>
    <td>{{ b.serial_no }}</td>
    <td>{{ "Yes" if b.available else "No" }}</td>
    <td>
      <!-- Update Button -->
      <button class="btn btn-primary btn-sm editBtn"
        data-id="{{ b.id }}"
        data-title="{{ b.title }}"
        data-author="{{ b.author }}"
        data-serial="{{ b.serial_no }}"
        data-bs-toggle="modal" data-bs-target="#editModal">
        Update
      </button>

      <!-- Delete Button -->
      <button class="btn btn-danger btn-sm deleteBtn"
        data-id="{{ b.id }}"
        data-bs-toggle="modal" data-bs-target="#deleteModal">
        Delete
      </button>
    </td>
  </tr>
  {% endfor %}
</table>


<!-- ðŸ”¹ Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <form action="/maintenance/books/modal/update" method="POST" class="modal-content">
      <div class="modal-header"><h5>Edit Book</h5></div>
      <div class="modal-body">
        <input type="hidden" name="id" id="edit_id">

        <label>Title</label>
        <input type="text" name="title" id="edit_title" class="form-control mb-2" required>

        <label>Author</label>
        <input type="text" name="author" id="edit_author" class="form-control mb-2" required>

        <label>Serial</label>
        <input type="text" name="serial_no" id="edit_serial" class="form-control mb-2" required>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success">Update</button>
      </div>
    </form>
  </div>
</div>


<!-- ðŸ”» Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <form action="/maintenance/books/modal/delete" method="POST" class="modal-content">
      <div class="modal-header bg-danger text-white"><h5>Confirm Delete</h5></div>
      <div class="modal-body">
        <input type="hidden" name="id" id="delete_id">
        Are you sure you want to delete this book?
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-danger">Delete</button>
      </div>
    </form>
  </div>
</div>


<!-- Bootstrap JS + jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Populate Edit Modal
$(".editBtn").click(function () {
    $("#edit_id").val($(this).data("id"));
    $("#edit_title").val($(this).data("title"));
    $("#edit_author").val($(this).data("author"));
    $("#edit_serial").val($(this).data("serial"));
});

// Populate Delete Modal
$(".deleteBtn").click(function () {
    $("#delete_id").val($(this).data("id"));
});
</script>

</body>
</html>